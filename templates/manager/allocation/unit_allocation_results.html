{% extends 'manager/base.html' %}

{% load crispy_forms_tags %} 

{% block page_title %}Project Allocation Results{% endblock %}
{% block extra_header %}
    <div class="my-3 mx-3 d-flex gap-5 row-gap-3 flex-column">
        <div class="d-flex gap-3">
            <div class="fw-semibold">Total No. Students</div>
            <div>{{ unit.students_count }}</div>
        </div>
        <div class="d-flex gap-3">
            <div class="fw-semibold">Total No. Students who Submitted Preferences</div>
            <div>{{ submitted_prefs_count }}</div>
        </div>
        <div class="d-flex gap-3">
            <div class="fw-semibold">Total No. Students who did not Submit Preferences</div>
            <div>{{ not_submitted_prefs_count }}</div>
        </div>
        <div class="d-flex gap-3">
            <div class="fw-semibold">Average Allocated Preference</div>
            <div>{{ unit.avg_allocated_pref_rounded }}</div>
        </div>
        <div class="d-flex gap-3">
            <div class="fw-semibold">Best Allocated Preference</div>
            <div>{{ unit.min_allocated_pref }}</div>
        </div>
        <div class="d-flex gap-3">
            <div class="fw-semibold">Worst Allocated Preference</div>
            <div>{{ unit.max_allocated_pref }}</div>
        </div>
    </div>
    <hr class="my-4">
{% endblock %}
{% block content %}
    {% if unit.completed_allocation %}
    <div class="alert alert-{% if unit.allocation_successful %}success{% else %}danger{% endif %}" role="alert">
        <div class="fw-bold">Allocation: {{ unit.get_allocation_descriptive }}</div>
        {% if unit.allocation_successful %}
            The allocation of students to projects was completed successfully.
        {% else %}
            The allocation of students to projects failed.
        {% endif %}
    </div>
    {% endif %}
    {% if unit.allocation_successful %}
        <div class="my-5">View the allocation by <a class="link-offset-2 link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover" href="{% url 'manager:unit-students' unit.id %}">students</a> or by <a class="link-offset-2 link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover" href="{% url 'manager:unit-projects' unit.id %}">projects</a>.</div>
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="mb-3">
                <button type="submit" name="download_results" class="btn btn-primary"><i class="bi bi-download"></i><span class="ms-1">Download Allocation Results as CSV</span></button>
                <button type="submit" name="email_results" class="btn btn-primary"><i class="bi bi-envelope-at"></i><span class="ms-1">Email Allocation Results as CSV</span></button>
            </div>
        </form>
    {% endif %}
{% endblock content %}