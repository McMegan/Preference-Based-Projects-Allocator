{% extends 'manager/base.html' %}

{% block page_title %}{{project.number}}: {{project.name}}{% endblock %}
{% block extra_header %}
    <div class="my-3 mx-3 d-flex gap-3 flex-column">
        <div class="d-flex gap-3">
            <div class="fw-semibold">Project Number</div>
            <div>{{ project.number }}</div>
        </div>
        <div class="d-flex gap-3">
            <div class="fw-semibold">Project Name</div>
            <div>{{ project.name }}</div>
        </div>
        <div class="d-flex gap-3">
            <div class="fw-semibold">Group Size</div>
            <div>{{ project.min_students }} - {{ project.max_students }}</div>
        </div>
        {% if project.description %}
        <div class="d-flex gap-3">
            <div class="fw-semibold">Description</div>
            <div>{{ project.description }}</div>
        </div>
        {% endif %}
    </div>
    <div class="my-3 mx-3 d-flex gap-2 flex-wrap">
        <a class="btn btn-primary" href="{% url 'manager:unit-project-update' unit.id project.id %}">Edit</a>
        <a class="btn btn-danger" href="{% url 'manager:unit-project-remove' unit.id project.id %}">Remove</a>
    </div>
    <hr class="my-4">
{% endblock %}
{% block content %}
    <ul class="nav nav-tabs border-0" id="tab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active fs-6" id="preference-tab" data-bs-toggle="tab" data-bs-target="#preference-tab-pane" type="button" role="tab" aria-controls="preference-tab-pane" aria-selected="true">Preference Distribution</button>
        </li>
        {% if project.assigned_students %}
        <li class="nav-item" role="presentation">
            <button class="nav-link fs-6" id="allocation-tab" data-bs-toggle="tab" data-bs-target="#allocation-tab-pane" type="button" role="tab" aria-controls="allocation-tab-pane" aria-selected="false">Allocated Students</button>
        </li>
        {% endif %}
    </ul>
    <div class="tab-content border rounded-bottom overflow-hidden" id="tabContent">
        {% if project.get_preference_counts %}
        <div class="tab-pane fade show active" id="preference-tab-pane" role="tabpanel" aria-labelledby="preference-tab" tabindex="0">
            <table class="table table-striped mb-0">
                <thead>
                    <tr>
                        <th scope="col">Rank</th>
                        <th scope="col">Number of Preferences</th>
                    </tr>
                </thead>
                <tbody>
                    {% for preference in project.get_preference_counts %}
                        <tr>
                            <th class="text-center" scope="row">{{ preference.rank }}</th>
                            <td>{{preference.student_count}}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
        {% if project.assigned_students %}
        <div class="tab-pane fade" id="allocation-tab-pane" role="tabpanel" aria-labelledby="allocation-tab" tabindex="0">
            <table class="table table-striped mb-0">
                <thead>
                    <tr>
                        <th scope="col">Student ID</th>
                        <th scope="col">Submitted Preferences</th>
                        <th>Allocated Preference</th>
                        <th scope="col"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for student in project.assigned_students.all %}
                        <tr>
                            <th scope="row"><a class="link-offset-2 link-offset-3-hover link-underline link-underline-opacity-0 link-underline-opacity-75-hover" href="{% url 'manager:unit-student-detail' unit.id student.id %}">{{ student.student_id }}</a></th>
                            <td><span class ="badge rounded-pill text-bg-{% if student.project_preferences.count %}success{% else %}danger{% endif %}"><i class="bi bi-{% if student.project_preferences.count %}check{% else %}x{% endif %}-lg"></i></span></td>
                            <td>{{student.assigned_preference_rank}}</td>
                            <td>
                                <div class="d-flex justify-content-end">
                                    <a class="btn btn-danger btn-sm" href="{% url 'manager:unit-student-remove' unit.id student.id %}">Remove</a>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
    </div>
{% endblock %}